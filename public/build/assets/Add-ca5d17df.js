import{k as _,c as A,w as m,r as h,o as f,a as l,b as n,f as a,t as r,i as x,v as V,d as b,g as L,F as I,e as C}from"./app-5577a803.js";import{A as R}from"./AppLayout-bf2c4329.js";import{J as w}from"./Label-715dcd10.js";import{J as N}from"./Button-caddf70d.js";import{J as U}from"./SecondaryButton-3445fa1d.js";import{J as E}from"./DangerButton-0ca7bbd2.js";import{T as F}from"./TextField-f2f734f3.js";import{M as P}from"./vue3-multiselect.umd.min-7dc826ba.js";import B from"./EditLine-a2dc5a07.js";/* empty css                                                                  */import{_ as J}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css            */import"./Edit-3518c8d0.js";import"./ActionMessage-c078ab58.js";import"./ActionSection-503f6cc4.js";import"./SectionTitle-75c86d6b.js";import"./ConfirmationModal-747d8d1a.js";import"./Modal-5b92d53d.js";import"./DialogModal-08c723b0.js";import"./FormSection-f05163be.js";import"./Input-2cb00575.js";import"./Checkbox-0b804630.js";import"./InputError-1ce94fe9.js";import"./SectionBorder-30338fa4.js";import"./ValidationErrors-deb0d81a.js";import"./Edit-0ce9ec78.js";import"./Edit-59e1cea4.js";import"./Edit-b100ce49.js";import"./Edit-a668fbc8.js";import"./Edit-8c1a7f79.js";import"./Reservation-3f4df2b7.js";import"./Edit-de74654e.js";import"./Edit-ca5432cf.js";import"./Edit-7a1531ea.js";import"./Load-69126cbc.js";import"./Load-60ee8871.js";import"./Edit-06b7cecc.js";import"./Upload-74253f6c.js";import"./Upload-272d6997.js";import"./Settings-4793b3a5.js";import"./Settings-36898752.js";import"./Upload-4d2df8c2.js";import"./Request-20c79d13.js";import"./Add-e36b326b.js";import"./Load-13d24c7d.js";import"./Upload-28c6b9dc.js";import"./Load-3369b54b.js";import"./sweetalert.min-ea747d9b.js";import"./ItemsMap-6b0c7b7d.js";import"./Upload-bd0ab3e3.js";import"./ItemsMap-58f762b0.js";import"./RequestEx-34c826cd.js";const M={components:{AppLayout:R,JetLabel:w,JetButton:N,JetSecondaryButton:U,JetDangerButton:E,DialogInvoiceLine:B,TextField:F,Multiselect:P},props:{invoice:{Type:Object,default:null},items:{Type:Object,default:null}},data(){return{addingNewLine:!0,currentItemIdx:0,tab_idx:1,currentItem:{quantity:1009},branches:[],customers:[],activities:[],errors:[],form:this.$inertia.form({issuer:"",receiver:"",name:"",documentType:"I",dateTimeIssued:new Date().toISOString().slice(0,16),taxpayerActivityCode:"",internalID:this.$page.props.auto_inv_num?"automatic":"0",purchaseOrderReference:"",purchaseOrderDescription:"",salesOrderReference:"",salesOrderDescription:"",purchaseOrderReference:"",proformaInvoiceNumber:"",totalSalesAmount:0,totalDiscountAmount:0,netAmount:0,totalAmount:0,extraDiscountAmount:0,totalItemsDiscountAmount:0,invoiceLines:[],taxTotals:[]})}},methods:{RecalculateTax:function(){this.form.totalSalesAmount=0,this.form.totalDiscountAmount=0,this.form.netAmount=0,this.form.totalAmount=0,this.form.totalItemsDiscountAmount=0;var o={};this.form.taxTotals=[];for(var e=0;e<this.form.invoiceLines.length;e++){var s=this.form.invoiceLines[e];this.form.totalSalesAmount+=parseFloat(s.salesTotal),s.discount&&(this.form.totalDiscountAmount+=parseFloat(s.discount.amount)),this.form.netAmount+=parseFloat(s.netTotal),this.form.totalAmount+=parseFloat(s.total),this.form.totalItemsDiscountAmount+=parseFloat(s.itemsDiscount);for(var c=0;c<s.taxItems.length;c++){var t=s.taxItems[c];t.taxType.Code in o?o[t.taxType.Code]=o[t.taxType.Code]+parseFloat(t.value):o[t.taxType.Code]=parseFloat(t.value)}}this.form.extraDiscountAmount=Math.round(this.form.extraDiscountAmount*1e5)/1e5,this.form.netAmount=Math.round(this.form.netAmount*1e5)/1e5,this.form.totalAmount=this.form.totalAmount-this.form.extraDiscountAmount,this.form.totalAmount=Math.round(this.form.totalAmount*1e5)/1e5,this.form.totalDiscountAmount=Math.round(this.form.totalDiscountAmount*1e5)/1e5,this.form.totalItemsDiscountAmount=Math.round(this.form.totalItemsDiscountAmount*1e5)/1e5,this.form.totalSalesAmount=Math.round(this.form.totalSalesAmount*1e5)/1e5;for(let d of Object.keys(o))this.form.taxTotals.push({taxType:d,amount:o[d]})},AddItem:function(){this.addingNewLine=!0,this.currentItem={quantity:1,totalTaxableFees:0,discount:{amount:0,rate:0},itemsDiscount:0,valueDifference:0,unitValue:{amountEGP:0,amountSold:0,currencySold:"EGP",currencyExchangeRate:1}},this.$nextTick(()=>{this.$refs.dlg1.ShowDialog()}),this.RecalculateTax()},DeleteItem:function(o){this.form.invoiceLines.splice(o,1),this.RecalculateTax()},EditItem:function(o,e){this.addingNewLine=!1,o.discount||(o.discount={amount:0,rate:0}),this.currentItem=o,this.currentItemIdx=e,this.$nextTick(()=>{this.$refs.dlg1.ShowDialog()}),this.RecalculateTax()},onClose:function(){this.currentItem.itemType=this.currentItem.item.codeTypeName,this.currentItem.itemCode=this.currentItem.item.itemCode,this.currentItem.unitType=this.currentItem.unit.code,this.currentItem.internalCode=this.currentItem.item.Id.toString();var o=this.currentItem.unitValue;this.currentItem.unitValue={},this.currentItem.unitValue.currencySold=o.currencySold,this.currentItem.unitValue.currencyExchangeRate=o.currencyExchangeRate,this.currentItem.unitValue.amountEGP=o.amountEGP,this.currentItem.unitValue.amountSold=o.amountSold,this.currentItem.taxableItems=this.currentItem.taxItems.map(function(e){var s={};return s.taxType=e.taxType.Code,s.amount=e.value,s.subType=e.taxSubtype.Code,s.rate=e.percentage,s}),this.addingNewLine?this.form.invoiceLines.push(this.currentItem):this.form.invoiceLines[this.currentItemIdx]=this.currentItem,this.addingNewLine=!1,this.RecalculateTax()},onCancel:function(){window.history.back()},onSave:function(){this.invoice&&(this.form.Id=this.invoice.Id),_.post(route("eta.invoices.store"),this.form).then(o=>{this.processing=!1,this.$nextTick(()=>this.$emit("dataUpdated")),this.form.reset(),this.form.processing=!1,this.addingNew=!1,this.tab_idx=1}).catch(o=>{this.form.processing=!1,this.$page.props.errors=o.response.data.errors,this.errors=o.response.data.errors})},getTaxStr:function(o){return o.taxType.Code?o.taxType.Code+"("+o.taxSubtype.Code+")":o.taxType+"("+o.subType+")"},getDocumentTitle:function(){return this.form.documentType=="I"?this.__("Invoice Summary"):this.form.documentType=="C"?this.__("Credit Note Summary"):this.form.documentType=="D"?this.__("Debit Note Summary"):this.__("Error!!")},nameWithId({name:o,receiver_id:e,Id:s}){return s+" - "+e+" - "+o},updateValues(){this.RecalculateTax()}},created:function(){_.get(route("json.branches")).then(e=>{this.branches=e.data,this.invoice&&(this.form.issuer=this.branches.find(s=>s.Id===this.invoice.issuer_id))}).catch(e=>{}),_.get(route("json.customers")).then(e=>{this.customers=e.data,this.invoice&&(this.form.receiver=this.customers.find(s=>s.Id===this.invoice.receiver_id))}).catch(e=>{}),_.get("/json/ActivityCodes.json").then(e=>{this.activities=e.data,this.invoice?this.form.taxpayerActivityCode=this.activities.find(s=>s.code===this.invoice.taxpayerActivityCode):this.form.taxpayerActivityCode=this.activities[0]}).catch(e=>{}),this.$nextTick(()=>{if(this.invoice){this.form.receiver=this.customers.find(c=>c.Id===this.invoice.receiver_id),this.form.name=this.invoice.name,this.form.taxpayerActivityCode=this.invoice.taxpayerActivityCode,this.form.internalID=this.invoice.internalID,this.form.totalSalesAmount=this.invoice.totalSalesAmount,this.form.totalDiscountAmount=this.invoice.totalDiscountAmount,this.form.netAmount=this.invoice.netAmount,this.form.totalAmount=this.invoice.totalAmount,this.form.extraDiscountAmount=this.invoice.extraDiscountAmount,this.form.totalItemsDiscountAmount=this.invoice.totalItemsDiscountAmount,this.form.invoiceLines=this.invoice.invoicelines,this.form.documentType=this.invoice.documentType,this.form.dateTimeIssued=this.invoice.dateTimeIssued.slice(0,16);for(var e=0;e<this.form.invoiceLines.length;e++){this.form.invoiceLines[e].unitValue=this.form.invoiceLines[e].unit_value,this.form.invoiceLines[e].taxItems=this.form.invoiceLines[e].taxable_items;for(var s=0;s<this.form.invoiceLines[e].taxItems.length;s++)this.form.invoiceLines[e].taxItems[s].value=this.form.invoiceLines[e].taxItems[s].amount,this.form.invoiceLines[e].taxItems[s].percentage=this.form.invoiceLines[e].taxItems[s].rate,this.form.invoiceLines[e].taxItems[s].taxType={Code:this.form.invoiceLines[e].taxItems[s].taxType},this.form.invoiceLines[e].taxItems[s].taxSubtype={Code:this.form.invoiceLines[e].taxItems[s].subType},this.form.invoiceLines[e].taxItems[s].taxType.label=this.form.invoiceLines[e].taxItems[s].taxType.Code,this.form.invoiceLines[e].taxItems[s].taxSubtype.label=this.form.invoiceLines[e].taxItems[s].taxSubtype.Code;this.form.invoiceLines[e].taxableItems=this.form.invoiceLines[e].taxItems.map(function(c){var t={};return t.taxType=c.taxType.Code,t.amount=c.value,t.subType=c.taxSubtype.Code,t.rate=c.percentage,t})}this.RecalculateTax()}})}},G={class:"py-4"},j={class:"mx-auto sm:px-6 lg:px-8"},q={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg px-4 pb-4 pt-0"},W={class:"flex items-center ms-0 mb-4 border-b border-gray-200"},Q={class:"grid lg:grid-cols-4 gap-4 sm:grid-cols-1 h-1/2 overflow"},z={class:"lg:col-span-2"},H={class:"lg:col-span-2"},K={class:"lg:col-span-2"},X={class:"grid lg:grid-cols-4 gap-4 sm:grid-cols-1 h-1/2 overflow"},Y={class:"grid grid-cols-10 gap-0 mt-2"},Z={class:"bg-gray-200 col-span-3"},$={class:"bg-gray-200 col-span-1"},ee={class:"bg-gray-200 col-span-1"},te={class:"bg-gray-200 col-span-1"},oe={class:"bg-gray-200 col-span-1"},ie={class:"bg-gray-200 col-span-1"},se=l("div",{class:"bg-gray-200 col-span-1"},null,-1),ne=l("div",{class:"bg-gray-200 col-span-1"},null,-1),re={class:"grid grid-cols-2 gap-1"},le={class:"flex items-center justify-end mt-4"},me={class:"border border-black"},ae={class:"flex items-center justify-end mt-20"};function ue(o,e,s,c,t,d){const S=h("dialog-invoice-line"),y=h("jet-button"),p=h("jet-label"),T=h("multiselect"),u=h("TextField"),D=h("jet-secondary-button"),O=h("jet-danger-button"),k=h("app-layout");return f(),A(k,null,{default:m(()=>[l("div",G,[n(S,{invoice:s.invoice,modelValue:t.currentItem,"onUpdate:modelValue":[e[0]||(e[0]=i=>t.currentItem=i),d.onClose],ref:"dlg1"},null,8,["invoice","modelValue","onUpdate:modelValue"]),l("div",j,[l("div",q,[l("div",W,[n(y,{onClick:e[1]||(e[1]=i=>t.tab_idx=1),disabled:t.tab_idx==1,isRounded:!1},{default:m(()=>[a(r(d.getDocumentTitle()),1)]),_:1},8,["disabled"]),n(y,{onClick:e[2]||(e[2]=i=>t.tab_idx=2),disabled:t.tab_idx==2,isRounded:!1},{default:m(()=>[a(r(o.__("Optional Data (PO, SO)")),1)]),_:1},8,["disabled"]),n(y,{onClick:e[3]||(e[3]=i=>t.tab_idx=3),disabled:t.tab_idx==3,isRounded:!1},{default:m(()=>[a(r(o.__("Invoice Items")),1)]),_:1},8,["disabled"])]),x(l("div",Q,[l("div",z,[n(p,{value:o.__("Branch")},null,8,["value"]),n(T,{modelValue:t.form.issuer,"onUpdate:modelValue":e[4]||(e[4]=i=>t.form.issuer=i),label:"name",options:t.branches,placeholder:"Select branch",disabled:t.form.documentType!="I"},null,8,["modelValue","options","disabled"])]),l("div",H,[n(p,{value:o.__("Customer")},null,8,["value"]),n(T,{modelValue:t.form.receiver,"onUpdate:modelValue":e[5]||(e[5]=i=>t.form.receiver=i),label:"name",options:t.customers,placeholder:"Select customer",disabled:t.form.documentType!="I","custom-label":d.nameWithId,"track-by":"Id"},null,8,["modelValue","options","disabled","custom-label"])]),l("div",K,[n(p,{value:o.__("Branch Activity")},null,8,["value"]),n(T,{modelValue:t.form.taxpayerActivityCode,"onUpdate:modelValue":e[6]||(e[6]=i=>t.form.taxpayerActivityCode=i),label:"Desc_ar",options:t.activities,placeholder:"Select activity",disabled:t.form.documentType!="I"},null,8,["modelValue","options","disabled"])]),n(u,{modelValue:t.form.dateTimeIssued,"onUpdate:modelValue":e[7]||(e[7]=i=>t.form.dateTimeIssued=i),itemType:"datetime-local",itemLabel:o.__("Invoice Date")},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.internalID,"onUpdate:modelValue":e[8]||(e[8]=i=>t.form.internalID=i),itemType:"text",itemLabel:o.__("Internal Invoice ID"),active:o.$page.props.auto_inv_num?!1:t.form.documentType=="I"},null,8,["modelValue","itemLabel","active"]),n(u,{modelValue:t.form.totalSalesAmount,"onUpdate:modelValue":e[9]||(e[9]=i=>t.form.totalSalesAmount=i),itemType:"number",itemLabel:o.__("Total Sales Amount"),active:!1},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.totalDiscountAmount,"onUpdate:modelValue":e[10]||(e[10]=i=>t.form.totalDiscountAmount=i),itemType:"number",itemLabel:o.__("Total Discount Amount"),active:!1},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.netAmount,"onUpdate:modelValue":e[11]||(e[11]=i=>t.form.netAmount=i),itemType:"number",itemLabel:o.__("Net Amount"),active:!1},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.totalAmount,"onUpdate:modelValue":e[12]||(e[12]=i=>t.form.totalAmount=i),itemType:"number",itemLabel:o.__("Total Amount"),active:!1},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.extraDiscountAmount,"onUpdate:modelValue":[e[13]||(e[13]=i=>t.form.extraDiscountAmount=i),e[14]||(e[14]=i=>d.updateValues())],itemType:"number",itemLabel:o.__("Extra Discount Amount")},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.totalItemsDiscountAmount,"onUpdate:modelValue":e[15]||(e[15]=i=>t.form.totalItemsDiscountAmount=i),itemType:"number",itemLabel:o.__("Total Items Discount Amount"),active:!1},null,8,["modelValue","itemLabel"])],512),[[V,t.tab_idx==1]]),x(l("div",X,[n(u,{modelValue:t.form.purchaseOrderReference,"onUpdate:modelValue":e[16]||(e[16]=i=>t.form.purchaseOrderReference=i),itemType:"text",itemLabel:o.__("Purchase Order")},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.purchaseOrderDescription,"onUpdate:modelValue":e[17]||(e[17]=i=>t.form.purchaseOrderDescription=i),itemType:"text",itemLabel:o.__("Purchase Order Description")},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.salesOrderReference,"onUpdate:modelValue":e[18]||(e[18]=i=>t.form.salesOrderReference=i),itemType:"text",itemLabel:o.__("Sales Order")},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.salesOrderDescription,"onUpdate:modelValue":e[19]||(e[19]=i=>t.form.salesOrderDescription=i),itemType:"text",itemLabel:o.__("Sales Order Description")},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.purchaseOrderReference,"onUpdate:modelValue":e[20]||(e[20]=i=>t.form.purchaseOrderReference=i),itemType:"text",itemLabel:o.__("Purchase Order Reference")},null,8,["modelValue","itemLabel"]),n(u,{modelValue:t.form.proformaInvoiceNumber,"onUpdate:modelValue":e[21]||(e[21]=i=>t.form.proformaInvoiceNumber=i),itemType:"text",itemLabel:o.__("Proforma Invoice Number")},null,8,["modelValue","itemLabel"])],512),[[V,t.tab_idx==2]]),x(l("div",null,[l("div",Y,[l("div",Z,r(o.__("Item")),1),l("div",$,r(o.__("Unit Price")),1),l("div",ee,r(o.__("Quantity")),1),l("div",te,r(o.__("Sales Total")),1),l("div",oe,r(o.__("Net Total")),1),l("div",ie,r(o.__("Tax Items")),1),se,ne,(f(!0),b(I,null,L(t.form.invoiceLines,(i,g)=>(f(),b(I,null,[n(p,{class:"mt-2 col-span-3"},{default:m(()=>[a(r(i.item.codeNamePrimaryLang),1)]),_:2},1024),n(p,{class:"mt-2 col-span-1"},{default:m(()=>[a(r(i.unitValue.amountEGP),1)]),_:2},1024),n(p,{class:"mt-2 col-span-1"},{default:m(()=>[a(r(i.quantity),1)]),_:2},1024),n(p,{class:"mt-2 col-span-1"},{default:m(()=>[a(r(i.salesTotal),1)]),_:2},1024),n(p,{class:"mt-2 col-span-1"},{default:m(()=>[a(r(i.netTotal),1)]),_:2},1024),l("div",re,[(f(!0),b(I,null,L(i.taxItems,(v,de)=>(f(),b(I,{key:v.key},[n(p,{class:"mt-2 col-span-2"},{default:m(()=>[a(r(d.getTaxStr(v)),1)]),_:2},1024),n(p,{class:"mt-2 col-span-2"},{default:m(()=>[a(r(v.value)+"("+r(v.percentage)+"%)",1)]),_:2},1024)],64))),128))]),n(D,{onClick:v=>d.EditItem(i,g),class:"h-12 mt-2 ms-2"},{default:m(()=>[a(r(o.__("Edit")),1)]),_:2},1032,["onClick"]),n(O,{onClick:v=>d.DeleteItem(g),class:"h-12 mt-2 ms-2"},{default:m(()=>[a(r(o.__("Delete")),1)]),_:2},1032,["onClick"])],64))),256)),t.form.invoiceLines.length?C("",!0):(f(),A(p,{key:0,class:"col-span-8"},{default:m(()=>[a(r(o.__("Please Add at least one item")),1)]),_:1}))]),l("div",le,[t.form.documentType=="I"?(f(),A(y,{key:0,class:"ms-2",onClick:e[22]||(e[22]=i=>d.AddItem())},{default:m(()=>[a(r(o.__("Add New Item")),1)]),_:1})):C("",!0)]),(f(!0),b(I,null,L(t.form.invoiceLines,(i,g)=>(f(),b("div",me))),256))],512),[[V,t.tab_idx==3]]),l("div",ae,[n(D,{onClick:e[23]||(e[23]=i=>d.onCancel())},{default:m(()=>[a(r(o.__("Cancel")),1)]),_:1}),n(y,{class:"ms-2",onClick:e[24]||(e[24]=i=>d.onSave())},{default:m(()=>[a(r(o.__("Save")),1)]),_:1})])])])])]),_:1})}const ut=J(M,[["render",ue]]);export{ut as default};
