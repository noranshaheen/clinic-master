import{J as C}from"./ActionMessage-517545cc.js";import{J as S}from"./ActionSection-2c866042.js";import{J as F}from"./Button-11813b5e.js";import{J as V}from"./SecondaryButton-8a1eaf86.js";import{J as w}from"./DangerButton-367e534b.js";import{J as A}from"./ConfirmationModal-0f300aca.js";import{J as I}from"./DialogModal-22356253.js";import{J as N}from"./FormSection-bd296fee.js";import{J as k}from"./Input-8a286b7b.js";import{J as B}from"./Checkbox-ebdeef89.js";import{J as M}from"./InputError-317c03cf.js";import{J as E}from"./Label-e291ccc6.js";import{J as U}from"./SectionBorder-822e764c.js";import{J as O}from"./ValidationErrors-31471297.js";import{T as P}from"./TextField-f89d8302.js";import{M as q}from"./vue3-multiselect.umd.min-939aa207.js";import{k as b,c as G,w as d,r as _,o as h,f as y,t as s,a as e,b as p,d as v,g as L,F as T,n as c,i as R,v as z}from"./app-010fad37.js";import{s as f}from"./sweetalert.min-679d9ee2.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import"./SectionTitle-8abeab5a.js";import"./Modal-97755a3c.js";/* empty css            */const W={components:{TextField:P,Multiselect:q,JetActionMessage:C,JetActionSection:S,JetButton:F,JetConfirmationModal:A,JetDangerButton:w,JetDialogModal:I,JetFormSection:N,JetInput:k,JetCheckbox:B,JetInputError:M,JetLabel:E,JetSecondaryButton:V,JetSectionBorder:U,JetValidationErrors:O},props:["modelValue"],data(){return{item:this.modelValue,count:1,units:[],items:[],taxTypes:[],taxSubtypes:[],taxSubtypes1:[],taxType:null,taxSubtype:null,showDlg:!1}},methods:{ShowDialog(){this.item=JSON.parse(JSON.stringify(this.modelValue)),this.item.dateTimeIssued=new Date().toISOString().slice(0,16),this.showDlg=!0},CancelDlg(){this.showDlg=!1},getDate(t){return new Date(t).toLocaleDateString()},updateValues(t){t.salesTotal=this.parse(t.quantity)*this.parse(t.unit_value.amountEGP),t.netTotal=t.salesTotal-this.parse(t.itemsDiscount),this.calculateTax(t),this.RecalculateTax()},calculateTax(t){if(t.total=t.netTotal+0,t.taxable_items)for(var o=0;o<t.taxable_items.length;o++){var a=t.taxable_items[o];a.amount=a.rate*t.netTotal/100,a.taxType=="T4"?t.total-=a.amount:t.total+=a.amount}},RecalculateTax:function(){this.item.totalSalesAmount=0,this.item.totalDiscountAmount=0,this.item.netAmount=0,this.item.totalAmount=0,this.item.extraDiscountAmount=0,this.item.totalItemsDiscountAmount=0;var t={};this.item.taxTotals=[];for(var o=0;o<this.item.invoice_lines.length;o++){var a=this.item.invoice_lines[o];this.item.totalSalesAmount+=parseFloat(a.salesTotal),this.item.totalDiscountAmount+=parseFloat(a.itemsDiscount),this.item.netAmount+=parseFloat(a.netTotal),this.item.totalAmount+=parseFloat(a.total),this.item.extraDiscountAmount+=0,this.item.totalItemsDiscountAmount+=parseFloat(a.itemsDiscount);for(var r=0;r<a.taxable_items.length;r++){var l=a.taxable_items[r];l.taxType in t?t[l.taxType]=t[l.taxType.Code]+parseFloat(l.amount):t[l.taxType]=parseFloat(l.amount)}}for(let n of Object.keys(t))this.item.taxTotals.push({taxType:n,amount:t[n]})},getTaxlines(t){for(var o=0,a=0;a<t.taxable_items.length;a++){var r=t.taxable_items[a];o=o+parseFloat(r.amount)}return o},getTotalTax(){for(var t=0,o=0;o<this.item.invoice_lines.length;o++)for(var a=this.item.invoice_lines[o],r=0;r<a.taxable_items.length;r++){var l=a.taxable_items[r];t=t+parseFloat(l.amount)}return t},SubmitCreditNote(){b.post(route("eta.invoices.credit.store"),this.item).then(t=>{f({title:"Invoice Credit Note Saved!",icon:"success"})}).catch(t=>{f({title:"Invoice Credit Note Failed",icon:"error"})})},CopyItem(){b.post(route("invoices.copy"),{Id:this.item.Id}).then(t=>{f({title:"Invoice Was Copied",icon:"success"}),setTimeout(()=>{window.location.reload()},200)}).catch(t=>{console.error(t)})}},created:function(){}},j={class:"grid grid-cols-10 gap-0 mt-2"},H={class:"col-span-5"},K={class:"col-span-5"},X={class:"col-span-5"},Y={class:"grid grid-cols-10 gap-0 mt-2"},Z={class:"bg-gray-400 col-span-3"},$={class:"bg-gray-400 col-span-2"},tt={class:"bg-gray-400 col-span-1"},et={class:"bg-gray-400 col-span-1"},ot={class:"bg-gray-400 col-span-1"},st={class:"bg-gray-400 col-span-1"},at={class:"bg-gray-400 col-span-1"},lt={class:"bg-gray-400 col-span-5"},it=e("div",{class:"bg-gray-400 col-span-1"},"****",-1),rt=e("div",{class:"bg-gray-400 col-span-1"},"****",-1),nt={class:"bg-gray-400 col-span-1"},mt={class:"bg-gray-400 col-span-1"},ct={class:"bg-gray-400 col-span-1"},ut={class:"flex items-center justify-between mt-4"};function dt(t,o,a,r,l,n){const g=_("TextField"),J=_("jet-secondary-button"),D=_("jet-button"),x=_("jet-dialog-modal");return h(),G(x,{show:l.showDlg,"max-width":"5xl",onClose:o[3]||(o[3]=i=>l.showDlg=!1)},{title:d(()=>[y(s(t.__("Invoice Credit Note")),1)]),content:d(()=>[e("div",j,[e("div",H,s(t.__("Branch"))+": "+s(l.item.issuer.name),1),e("div",K,s(t.__("Customer"))+": "+s(l.item.receiver.name),1),e("div",X,[p(g,{modelValue:l.item.dateTimeIssued,"onUpdate:modelValue":o[0]||(o[0]=i=>l.item.dateTimeIssued=i),itemType:"datetime-local",itemLabel:t.__("Invoice Date")},null,8,["modelValue","itemLabel"])])]),e("div",Y,[e("div",Z,s(t.__("Item")),1),e("div",$,s(t.__("Code")),1),e("div",tt,s(t.__("Quantity")),1),e("div",et,s(t.__("Unit Price")),1),e("div",ot,s(t.__("Sales")),1),e("div",st,s(t.__("Tax")),1),e("div",at,s(t.__("Total")),1),(h(!0),v(T,null,L(l.item.invoice_lines,(i,m)=>(h(),v(T,{key:m},[e("div",{class:c(["col-span-3",{"bg-gray-200":m%2==1}])},s(i.description),3),e("div",{class:c(["col-span-2",{"bg-gray-200":m%2==1}])},s(i.itemCode),3),e("div",{class:c(["col-span-1",{"bg-gray-200":m%2==1}])},[p(g,{modelValue:i.quantity,"onUpdate:modelValue":[u=>i.quantity=u,u=>n.updateValues(i)],itemType:"number"},null,8,["modelValue","onUpdate:modelValue"])],2),e("div",{class:c(["col-span-1",{"bg-gray-200":m%2==1}])},[p(g,{modelValue:i.unit_value.amountEGP,"onUpdate:modelValue":[u=>i.unit_value.amountEGP=u,u=>n.updateValues(i)],itemType:"number"},null,8,["modelValue","onUpdate:modelValue"])],2),e("div",{class:c(["col-span-1",{"bg-gray-200":m%2==1}])},s((Math.round(100*i.salesTotal)/100).toFixed(2)),3),e("div",{class:c(["col-span-1",{"bg-gray-200":m%2==1}])},s(n.getTaxlines(i).toFixed(2)),3),e("div",{class:c(["col-span-1",{"bg-gray-200":m%2==1}])},s((Math.round(100*i.total)/100).toFixed(2)),3)],64))),128)),e("div",lt,s(t.__("Summary")),1),it,rt,e("div",nt,s((Math.round(100*l.item.totalSalesAmount)/100).toFixed(2)),1),e("div",mt,s(n.getTotalTax().toFixed(2)),1),e("div",ct,s((Math.round(100*l.item.totalAmount)/100).toFixed(2)),1)])]),footer:d(()=>[e("div",ut,[p(J,{onClick:o[1]||(o[1]=i=>n.CancelDlg())},{default:d(()=>[y(s(t.__("Close")),1)]),_:1}),R(e("div",null,[p(D,{class:"ms-2",onClick:o[2]||(o[2]=i=>n.SubmitCreditNote())},{default:d(()=>[y(s(t.__("Approve")),1)]),_:1})],512),[[z,l.item.status=="Valid"]])])]),_:1},8,["show"])}const Mt=Q(W,[["render",dt]]);export{Mt as default};
