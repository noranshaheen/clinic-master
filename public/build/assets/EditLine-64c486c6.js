import{J}from"./ActionMessage-529841b6.js";import{J as L}from"./ActionSection-14bbef3c.js";import{J as U}from"./Button-fce1e67a.js";import{J as k}from"./SecondaryButton-fb7ef34d.js";import{J as w}from"./DangerButton-bf3f8f1f.js";import{J as j}from"./ConfirmationModal-2d2586d4.js";import{J as E}from"./DialogModal-9cb7d35f.js";import{J as F}from"./FormSection-60b88c5f.js";import{J as P}from"./Input-9c9fd5b2.js";import{J as N}from"./Checkbox-7ff4e1d6.js";import{J as A}from"./InputError-48880b4d.js";import{J as B}from"./Label-c6c7e0c2.js";import{J as M}from"./SectionBorder-a45d0249.js";import{J as q}from"./ValidationErrors-ce3c07bd.js";import{T as G}from"./TextField-4dc08153.js";import{M as R}from"./vue3-multiselect.umd.min-89fe1e95.js";import{k as y,c as x,w as r,r as p,o as f,f as c,t as m,a as n,b as s,i as O,C as W,d as T,g as _,F as V,e as Q}from"./app-98cccb0d.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";import"./SectionTitle-f26ec90c.js";import"./Modal-2ccc6cf7.js";/* empty css            */const H={components:{TextField:G,Multiselect:R,JetActionMessage:J,JetActionSection:L,JetButton:U,JetConfirmationModal:j,JetDangerButton:w,JetDialogModal:E,JetFormSection:F,JetInput:P,JetCheckbox:N,JetInputError:A,JetLabel:B,JetSecondaryButton:k,JetSectionBorder:M,JetValidationErrors:q},props:["modelValue","invoice"],emits:["update:modelValue"],data(){return{item:this.modelValue,count:1,units:[],items:[],taxTypes:[],taxSubtypes:[],taxSubtypes1:[],taxType:null,taxSubtype:null,showDlg:!1}},methods:{ShowDialog(){this.item=JSON.parse(JSON.stringify(this.modelValue)),this.showDlg=!0,this.item&&(this.item.unit=this.units.find(t=>t.code===this.item.unitType)),this.taxTypes.forEach(t=>{t.$isDisabled=!1})},CancelDlg(){this.showDlg=!1,this.updateTaxTypes()},updateDescription(){this.$page.props.locale=="ar"?this.item.description=this.item.item.codeNameSecondaryLang:this.item.description=this.item.item.codeNamePrimaryLang},AddTaxItem(){(!this.item.taxItems||this.item.taxItems.length==0)&&(this.item.taxItems=[]),this.item.taxItems.push({taxType:this.taxType,taxSubtype:this.taxSubtype,value:0,percentage:0,key:this.count,temp:!0}),this.taxTypes.filter(t=>t.Code==this.taxType.Code)[0].$isDisabled=!0,this.taxType=null,this.taxSubtype=null,this.count=this.count+1},updateTaxSubtypes(){this.taxSubtypes1=this.taxSubtypes.filter(t=>{if(t.TaxtypeReference==this.taxType.Code)return t}),this.subType={}},calculateTax(){if(this.item.total=this.item.salesTotal-this.parse(this.item.discount.amount)-this.parse(this.item.itemsDiscount),this.item.taxItems)for(var t=0;t<this.item.taxItems.length;t++){var e=this.item.taxItems[t];e.value=e.percentage*(this.item.netTotal+this.parse(this.item.valueDifference))/100,e.taxType.Code=="T4"?this.item.total-=e.value:this.item.total+=e.value}this.item.total=this.item.total.toFixed(5)},updateValues(){this.item.salesTotal=(this.parse(this.item.quantity)*this.parse(this.item.unitValue.amountEGP)).toFixed(5),this.item.netTotal=this.item.salesTotal-this.item.discount.amount,this.calculateTax()},updateValue(t,e){t.value=((this.item.netTotal+this.parse(this.item.valueDifference))*e/100).toFixed(5),this.$nextTick(()=>{this.calculateTax()})},updatePercentage(t,e){t.percentage=e*100/(this.item.netTotal+this.parse(this.item.valueDifference)),this.$nextTick(()=>{this.calculateTax()})},SaveItem(){this.item.isDirty=!0,this.showDlg=!1,(!this.item.taxItems||this.item.taxItems.length==0)&&(this.item.taxItems=[]),this.item.taxItems.forEach(t=>{t.temp=!1}),this.$emit("update:modelValue",this.item)},deleteItem(t){this.taxTypes.filter(e=>e.Code==this.item.taxItems[t].taxType.Code)[0].$isDisabled=!1,this.item.taxItems.splice(t,1)},updateTaxTypes(){if(this.taxTypes.forEach(t=>{t.$isDisabled=!1}),this.invoice){const t=this.invoice.invoicelines.filter(a=>a.Id==this.item.Id)[0];if(t==null)return;const e=t.taxItems.map(a=>a.taxType.Code);this.taxTypes.forEach(a=>{e.includes(a.Code)&&(a.$isDisabled=!0)})}else{this.item.taxItems=this.item.taxItems.filter(e=>e.temp===!1);const t=this.item.taxItems.map(e=>e.taxType.Code);this.taxTypes.forEach(e=>{t.includes(e.Code)&&(e.$isDisabled=!0)})}},nameWithCode({codeNamePrimaryLang:t,codeNameSecondaryLang:e,itemCode:a}){return this.$page.props.locale=="ar"?a+" - "+e:a+" - "+t}},created:function(){y.get(route("json.eta.items")).then(e=>{this.items=e.data}).catch(e=>{}),y.get("/json/UnitTypes.json").then(e=>{this.units=e.data,this.item&&(this.item.unit=this.units.find(a=>a.code===this.item.unitType))}).catch(e=>{}),y.get("/json/TaxSubtypes.json").then(e=>{this.taxSubtypes=e.data,this.taxSubtypes=this.taxSubtypes.map(a=>(a.label=a.Code.concat("(",a.Desc_ar,")"),a))}).catch(e=>{}),y.get("/json/TaxTypes.json").then(e=>{this.taxTypes=e.data,this.taxTypes=this.taxTypes.map(a=>(a.label=a.Code.concat("(",a.Desc_ar,")"),a))}).catch(e=>{})},watch:{showDlg(t,e){this.invoice&&this.updateTaxTypes()}}},K={class:"grid grid-cols-4 gap-4 border-b border-gray-20 pb-4"},X={class:"col-span-4"},Y={class:"col-span-4"},Z={class:"col-span-2"},$=["value"],ee={class:"grid grid-cols-7 gap-2 mt-2 border-t border-b border-gray-20"},te={class:"flex items-center justify-center"},le={class:"grid grid-cols-7 gap-0 mt-2"},ie={class:"bg-gray-200 col-span-2"},se={class:"bg-gray-200 col-span-2"},ae={class:"bg-gray-200 col-span-1"},oe={class:"bg-gray-200 col-span-1"},ne=n("div",{class:"bg-gray-200 col-span-1"},null,-1),me={class:"flex items-center justify-end mt-4"};function ue(t,e,a,re,i,o){const h=p("jet-label"),b=p("multiselect"),u=p("TextField"),g=p("jet-secondary-button"),v=p("jet-input"),S=p("jet-danger-button"),D=p("jet-button"),I=p("jet-dialog-modal");return f(),x(I,{show:i.showDlg,"max-width":"3xl",onClose:o.CancelDlg},{title:r(()=>[c(m(t.__("Add item to the invoice")),1)]),content:r(()=>[n("div",K,[n("div",X,[s(h,{value:t.__("Item")},null,8,["value"]),s(b,{modelValue:i.item.item,"onUpdate:modelValue":[e[0]||(e[0]=l=>i.item.item=l),o.updateDescription],options:i.items,"custom-label":o.nameWithCode,label:"codeNamePrimaryLang","track-by":"itemCode",placeholder:t.__("Select item")},null,8,["modelValue","options","custom-label","onUpdate:modelValue","placeholder"])]),n("div",Y,[s(u,{modelValue:i.item.description,"onUpdate:modelValue":e[1]||(e[1]=l=>i.item.description=l),itemType:"text",itemLabel:t.__("Custom Description"),active:t.$page.props.custom_desc_enabled},null,8,["modelValue","itemLabel","active"])]),n("div",Z,[s(h,{value:t.__("Units")},null,8,["value"]),s(b,{modelValue:i.item.unit,"onUpdate:modelValue":e[2]||(e[2]=l=>i.item.unit=l),options:i.units,label:"desc_en",placeholder:t.__("Select measurement unit")},null,8,["modelValue","options","placeholder"])]),n("div",null,[s(h,{value:t.__("Currency")},null,8,["value"]),O(n("select",{id:"currencySold","onUpdate:modelValue":e[3]||(e[3]=l=>i.item.unitValue.currencySold=l),class:"mt-1 block w-full rounded border border-gray-300 focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 shadow-sm"},[(f(!0),T(V,null,_(t.$page.props.currencies,l=>(f(),T("option",{value:l},m(t.__(l)),9,$))),256))],512),[[W,i.item.unitValue.currencySold]])]),s(u,{modelValue:i.item.unitValue.amountSold,"onUpdate:modelValue":[e[4]||(e[4]=l=>i.item.unitValue.amountSold=l),e[5]||(e[5]=l=>o.updateValues())],itemType:"number",itemLabel:t.__("Unit Price")},null,8,["modelValue","itemLabel"]),s(u,{modelValue:i.item.quantity,"onUpdate:modelValue":[e[6]||(e[6]=l=>i.item.quantity=l),e[7]||(e[7]=l=>o.updateValues())],itemType:"number",itemLabel:t.__("Quantity")},null,8,["modelValue","itemLabel"]),s(u,{modelValue:i.item.unitValue.amountEGP,"onUpdate:modelValue":[e[8]||(e[8]=l=>i.item.unitValue.amountEGP=l),e[9]||(e[9]=l=>o.updateValues())],itemType:"number",itemLabel:t.__("Unit Price (EGP)")},null,8,["modelValue","itemLabel"]),s(u,{modelValue:i.item.salesTotal,"onUpdate:modelValue":e[10]||(e[10]=l=>i.item.salesTotal=l),itemType:"number",itemLabel:t.__("Sales Total"),active:!1},null,8,["modelValue","itemLabel"]),s(u,{modelValue:i.item.total,"onUpdate:modelValue":e[11]||(e[11]=l=>i.item.total=l),itemType:"number",itemLabel:t.__("Total"),active:!1},null,8,["modelValue","itemLabel"]),s(u,{modelValue:i.item.valueDifference,"onUpdate:modelValue":[e[12]||(e[12]=l=>i.item.valueDifference=l),e[13]||(e[13]=l=>o.updateValues())],itemType:"number",itemLabel:t.__("Value Difference")},null,8,["modelValue","itemLabel"]),s(u,{modelValue:i.item.totalTaxableFees,"onUpdate:modelValue":e[14]||(e[14]=l=>i.item.totalTaxableFees=l),itemType:"number",itemLabel:t.__("Total Taxable Fees")},null,8,["modelValue","itemLabel"]),s(u,{modelValue:i.item.netTotal,"onUpdate:modelValue":e[15]||(e[15]=l=>i.item.netTotal=l),itemType:"number",itemLabel:t.__("Net Total"),active:!1},null,8,["modelValue","itemLabel"]),s(u,{modelValue:i.item.discount.amount,"onUpdate:modelValue":[e[16]||(e[16]=l=>i.item.discount.amount=l),e[17]||(e[17]=l=>o.updateValues())],itemType:"number",itemLabel:t.__("Items Discount (Before Tax)")},null,8,["modelValue","itemLabel"]),s(u,{modelValue:i.item.itemsDiscount,"onUpdate:modelValue":[e[18]||(e[18]=l=>i.item.itemsDiscount=l),e[19]||(e[19]=l=>o.updateValues())],itemType:"number",itemLabel:t.__("Items Discount (After Tax)")},null,8,["modelValue","itemLabel"])]),n("div",ee,[s(b,{class:"col-span-3",modelValue:i.taxType,"onUpdate:modelValue":[e[20]||(e[20]=l=>i.taxType=l),o.updateTaxSubtypes],label:"label",placeholder:t.__("Select Tax Type"),options:i.taxTypes},null,8,["modelValue","placeholder","options","onUpdate:modelValue"]),s(b,{class:"col-span-3",modelValue:i.taxSubtype,"onUpdate:modelValue":e[21]||(e[21]=l=>i.taxSubtype=l),placeholder:t.__("Select Tax Subtype"),options:i.taxSubtypes1,label:"label"},null,8,["modelValue","placeholder","options"]),n("div",te,[s(g,{onClick:e[22]||(e[22]=l=>o.AddTaxItem())},{default:r(()=>[c(m(t.__("Add Tax")),1)]),_:1})])]),n("div",le,[n("div",ie,m(t.__("Tax Code")),1),n("div",se,m(t.__("Tax Subcode")),1),n("div",ae,m(t.__("Tax Amount")),1),n("div",oe,m(t.__("Tax Percentage")),1),ne,(f(!0),T(V,null,_(i.item.taxItems,(l,C)=>(f(),T(V,{key:l.key},[s(h,{class:"mt-2 col-span-2"},{default:r(()=>[c(m(l.taxType.label),1)]),_:2},1024),s(h,{class:"mt-2 col-span-2"},{default:r(()=>[c(m(l.taxSubtype.label),1)]),_:2},1024),s(v,{id:l.key,type:"number",class:"mt-1 block w-full mt-2 col-span-1",isRounded:!1,"onUpdate:modelValue":[d=>o.updatePercentage(l,d),d=>l.value=d],modelValue:l.value,required:"",autofocus:""},null,8,["id","onUpdate:modelValue","modelValue"]),s(v,{id:l.key,type:"number",class:"mt-1 block w-full mt-2 col-span-1",isRounded:!1,"onUpdate:modelValue":[d=>o.updateValue(l,d),d=>l.percentage=d],modelValue:l.percentage,required:"",autofocus:""},null,8,["id","onUpdate:modelValue","modelValue"]),s(S,{onClick:d=>o.deleteItem(C),class:"mt-2 ms-2"},{default:r(()=>[c(m(t.__("Delete")),1)]),_:2},1032,["onClick"])],64))),128)),!i.item.taxItems||i.item.taxItems.length==0?(f(),x(h,{key:0,class:"col-span-7"},{default:r(()=>[c(m(t.__("Please Add tax items if applicable")),1)]),_:1})):Q("",!0)])]),footer:r(()=>[n("div",me,[s(g,{onClick:e[23]||(e[23]=l=>o.CancelDlg())},{default:r(()=>[c(m(t.__("Cancel")),1)]),_:1}),s(D,{class:"ms-2",onClick:e[24]||(e[24]=l=>o.SaveItem())},{default:r(()=>[c(m(t.__("Save")),1)]),_:1})])]),_:1},8,["show","onClose"])}const we=z(H,[["render",ue]]);export{we as default};
